
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Una introducción a la placa ESP32 micro:steamakers que es muy similar a la Placa ESP32 STEAMakers, pero en este caso tiene el formato de la micro:bit.">
      
      
        <meta name="author" content="Federico Coca">
      
      
        <link rel="canonical" href="https://fgcoca.github.io/....https:/fgcoca.github.io/ESP32-micro-STEAMakers/proyectos/i2ctouno/">
      
      
        <link rel="prev" href="../../actividadesAB/act_ava/">
      
      
        <link rel="next" href="../udp/">
      
      
      <link rel="icon" href="../../img/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.5">
    
    
      
        <title>I2C entre micro:STEAMakers y UNO - ESP32 micro:STEAMakers</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6a10b989.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.356b1318.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
        html.glightbox-open { overflow: initial; height: 100%; }
        .gslide-title { margin-top: 0px; user-select: text; }
        .gslide-desc { color: #666; user-select: text; }
        .gslide-image img { background: white; }
        
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
            </style> <script src="../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="light-blue" data-md-color-accent="deep-purple">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#introduccion" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href="../.." title="ESP32 micro:STEAMakers" class="md-header__button md-logo" aria-label="ESP32 micro:STEAMakers" data-md-component="logo">
      
  <img src="../../img/favicon.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ESP32 micro:STEAMakers
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              I2C entre micro:STEAMakers y UNO
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="light-blue" data-md-color-accent="deep-purple"  aria-label="Modo Oscuro"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Modo Oscuro" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="light-blue" data-md-color-accent="deep-purple"  aria-label="Modo Claro"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Modo Claro" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5Z"/></svg>
      </label>
    
  
</form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Búsqueda" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Buscar">
        
        <button type="reset" class="md-search__icon md-icon" title="Limpiar" aria-label="Limpiar" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando búsqueda
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/fgcoca/ESP32-micro-STEAMakers" title="Ir al repositorio" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    fgcoca/ESP32-micro-STEAMakers
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Pestañas" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../presenta/" class="md-tabs__link">
          
  
  ESP32 micro:STEAMakers

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../CO2/" class="md-tabs__link">
          
  
  Teoria general

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../guiamb/donde/" class="md-tabs__link">
          
  
  MicroBlocks

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../IDE/introIDE/" class="md-tabs__link">
          
  
  Arduino2.0

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../program/inicio/" class="md-tabs__link">
          
  
  Arduinoblocks

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="./" class="md-tabs__link">
          
  
  Proyectos

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../Miscelanea/about/" class="md-tabs__link">
          
  
  Miscelanea

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navegación" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="ESP32 micro:STEAMakers" class="md-nav__button md-logo" aria-label="ESP32 micro:STEAMakers" data-md-component="logo">
      
  <img src="../../img/favicon.png" alt="logo">

    </a>
    ESP32 micro:STEAMakers
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/fgcoca/ESP32-micro-STEAMakers" title="Ir al repositorio" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    fgcoca/ESP32-micro-STEAMakers
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="">
            
  
  <span class="md-ellipsis">
    ESP32 micro:STEAMakers
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            ESP32 micro:STEAMakers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../presenta/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Presentación
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    La ESP32 micro:STEAMakers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../ch340/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Interface USB CH340
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../otrohw/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Otros elementos hardware
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../escudos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Algunos escudos (Shields)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../shieldbit/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Shield:bit
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Teoria general
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Teoria general
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../CO2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Conceptos sobre CO2 y VOC
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../MiCS4514/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sensor MiCS4514 de NO2 y CO
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../rgb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Diodos LEDs RGB y modelos de color
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../oled/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pantalla OLED 0.96"
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../program/thinspeak/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Teoría básica de IoT
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../program/espnow/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ESP-NOW
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../bt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Comunicaciones Bluetooth
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../mdc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    El motor DC
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../servo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Servomotor
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../pap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Motor paso a paso
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    MicroBlocks
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            MicroBlocks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../guiamb/donde/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Donde encontrarlo
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../guiamb/mblocks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Guía de MicroBlocks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../guiamb/webserial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Web Serial ESPTool
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../guiamb/boardie/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Boardie:un tablero virtual para MicroBlocks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../guiamb/ublocks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Programación micro:STEAMakers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../guiamb/ble_inventor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Extensión BluetoothLE de App Inventor
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../guiamb/mb_inventor_BLE/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    mBlocks + App Inventor + BLE
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../actividadesmB/act_ini_mB/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Actividades iniciales
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../actividadesmB/act_sb_mB/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Actividades Shield:bit
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Arduino2.0
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Arduino2.0
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../IDE/introIDE/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introducción
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../IDE/codigoAB/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Código en Arduinoblocks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../IDE/descarga/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Descarga del IDE
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../IDE/ventanaIDE/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ventana principal del IDE
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../IDE/caracteristicasIDE2_0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Características principales del IDE 2.0
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Arduinoblocks
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Arduinoblocks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../program/inicio/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Programación de micro:STEAMakers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../program/RTTTL/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Formato RTTTL
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../program/server/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Servidor web
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../program/tm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    micro:STEAMakers + Telegram
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../program/iotAB/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    IoT
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../program/espnowAB/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ESP-NOW
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../actividadesAB/act_ini/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Actividades iniciales
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../actividadesAB/act_EP/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Actividades EASY Plug
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../actividadesAB/act_ava/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Actividades avanzadas y con shield modular
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Proyectos
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Proyectos
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    I2C entre micro:STEAMakers y UNO
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    I2C entre micro:STEAMakers y UNO
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduccion" class="md-nav__link">
    Introducción
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#objetivo" class="md-nav__link">
    Objetivo
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#materiales-necesarios" class="md-nav__link">
    Materiales necesarios
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuracion" class="md-nav__link">
    Configuración
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#procedimiento" class="md-nav__link">
    Procedimiento
  </a>
  
    <nav class="md-nav" aria-label="Procedimiento">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bloques-i2c-de-microblocks" class="md-nav__link">
    Bloques I2C de microBlocks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#programa-para-la-microsteamakers_v1" class="md-nav__link">
    Programa para la micro:STEAMakers_V1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#programa-para-la-microsteamakers_v2" class="md-nav__link">
    Programa para la micro:STEAMakers_V2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#codigo-para-el-ide-de-arduino" class="md-nav__link">
    Código para el IDE de Arduino
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../udp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Control remoto por UDP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../microblocks_websocket/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Integración de MicroBlocks y APP Inventor WEBsocket
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Miscelanea
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Miscelanea
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../Miscelanea/about/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Autoria
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../Miscelanea/lic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Licencias
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../Miscelanea/webgrafia/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Webgrafia/Bibliografía
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../Miscelanea/soft/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Software utilizado
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduccion" class="md-nav__link">
    Introducción
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#objetivo" class="md-nav__link">
    Objetivo
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#materiales-necesarios" class="md-nav__link">
    Materiales necesarios
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuracion" class="md-nav__link">
    Configuración
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#procedimiento" class="md-nav__link">
    Procedimiento
  </a>
  
    <nav class="md-nav" aria-label="Procedimiento">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bloques-i2c-de-microblocks" class="md-nav__link">
    Bloques I2C de microBlocks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#programa-para-la-microsteamakers_v1" class="md-nav__link">
    Programa para la micro:STEAMakers_V1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#programa-para-la-microsteamakers_v2" class="md-nav__link">
    Programa para la micro:STEAMakers_V2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#codigo-para-el-ide-de-arduino" class="md-nav__link">
    Código para el IDE de Arduino
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>I2C entre micro:STEAMakers y UNO</h1>

<p>El presente proyecto es una adaptación de la entrada <a href="https://wiki.microblocks.fun/en/communicate_with_arduino_via_i2c">I2C between micro:bit and Arduino</a> disponible en la <a href="https://wiki.microblocks.fun/en/home">MicroBlocks Wiki</a> que es un paso a paso para utilizar la comunicación i2c entre una micro:bit y un Arduino (avanzado) creado por <a href="https://microblocks.fun/about">Turgut Guneysu</a> un defensor de la programación basada en bloques y contribuidor de los entornos MicroBlocks y SNAP.</p>
<h2 id="introduccion"><FONT COLOR=#007575><strong>Introducción</strong></font><a class="headerlink" href="#introduccion" title="Permanent link">&para;</a></h2>
<p><a class="glightbox" href="../../img/proyectos/i2c_bus.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img align="right" alt="I2C bus" src="../../img/proyectos/i2c_bus.png" /></a></p>
<p>MicroBlocks soporta tanto comunicaciones I2C como SPI. En este artículo estableceremos un enlace I2C desde una micro:STEAMakers a un Arduino y estableceremos comunicación entre ellos.</p>
<p>I2C utiliza sólo dos cables y es muy fácil de configurar. Un cable SCL proporciona la señalización de reloj entre los sistemas. El otro SDA se utiliza para transferir datos en ambas direcciones.</p>
<p>Los dispositivos se designan como Maestro o Esclavo, siendo el Maestro el que controla todos los intercambios. En nuestro proyecto, micro:STEAMakers será maestro y Arduino será esclavo.</p>
<h2 id="objetivo"><FONT COLOR=#007575><strong>Objetivo</strong></font><a class="headerlink" href="#objetivo" title="Permanent link">&para;</a></h2>
<p>Seguirás las instrucciones para cablear los dos dispositivos para establecer un enlace entre ellos y para alimentarlos. A continuación, veremos la codificación necesaria para que ambos dispositivos implementen el protocolo I2C. Finalmente, intercambiaremos algunos mensajes entre micro:STEAMakers y Arduino.</p>
<h2 id="materiales-necesarios"><FONT COLOR=#007575><strong>Materiales necesarios</strong></font><a class="headerlink" href="#materiales-necesarios" title="Permanent link">&para;</a></h2>
<ul>
<li>ESP32 micro:STEAMakers y cable USB-A a USB-C</li>
<li>Arduino UNO o equivalente y cable USB-A a USB-B</li>
<li>Alguna placa breakout compatible que nos ofrezca conexión I2C. Nosotros usaremos la placa <a href="https://shop.innovadidactic.com/ca/micro-bit-placas-shields-y-kits/1675-placa-de-expansion-shield-bit-con-controlador-de-motores.html">Shield:bit</a></li>
<li>3 cables dupont M/F (Macho/Hembra) o 3 cables dupont M/M (Macho/Macho) de 20cm</li>
<li>Ordenador con dos puertos USB</li>
</ul>
<p><strong>Programas listos para descargar:</strong></p>
<ul>
<li>Para micro:STEAMakers, versión 1:  Programa de MicroBlocks <a href="../../program/actividadesmB/Programa_I2C_a_UNO_V1.ubp">Programa_I2C_a_UNO_V1</a>.</li>
<li>Para micro:STEAMakers, versión 2:  Programa de MicroBlocks <a href="../../program/actividadesmB/Programa_I2C_a_UNO_V2.ubp">Programa_I2C_a_UNO_V2</a>.</li>
<li>Para placa tipo UNO: Programa para el IDE 2.3.4 de Arduino <a href="../../program/comunicacion_i2c/comunicacion_i2c.ino">Código en el IDE 2.3.4 de Arduino</a></li>
</ul>
<div class="admonition info">
<p class="admonition-title">NOTA:</p>
<p>Se presupone que el lector está familiarizado con el uso del IDE 2.3.4 de Arduino y la carga de programas en placas tipo Arduino UNO.</p>
</div>
<h2 id="configuracion"><FONT COLOR=#007575><strong>Configuración</strong></font><a class="headerlink" href="#configuracion" title="Permanent link">&para;</a></h2>
<p>Para establecer la conectividad I2C en las placas Shield:Bit + micro:STEAMakers y UNO tienes que realizar el cableado de la imagen siguiente:</p>
<p><center></p>
<p><a class="glightbox" href="../../img/proyectos/sb_UNO.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Cableado entre Shield:Bit y UNO" src="../../img/proyectos/sb_UNO.png" /></a><br />
<em>Cableado entre Shield:Bit y UNO</em></p>
<p></center></p>
<p>Además de la conectividad entre las placas mostradas arriba, recuerda usar los respectivos cables USB para conectarlas a tu ordenador para programarlas.</p>
<div class="admonition danger">
<p class="admonition-title">IMPORTANTE</p>
<p>La micro:STEAMaker dispone de conector I2C hembra por lo que cabe pensar que se puede prescindir de la placa breakout.</p>
<p>Micro:STEAMakers y Arduino UNO o equivalente utilizan diferentes voltajes de alimentación, 3.3V y 5V respectivamente. Por favor, <font color=#FF0000><strong>NO</strong></font> conectes directamente estas dos placa una con otra sin una placa breakout que proporcione la conversión de voltaje.</p>
<p><center></p>
<p><a class="glightbox" href="../../img/proyectos/mSM_UNO.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Cableado entre micro:STEAMaker y UNO (NO PERMITIDO)" src="../../img/proyectos/mSM_UNO.png" /></a><br />
<em>Cableado entre micro:STEAMaker y UNO (NO PERMITIDO)</em></p>
<p></center></p>
<div class="admonition warning">
<p class="admonition-title">EXCEPCIÓN</p>
<p>La placa Keyestudio UNO que se ve en la imagen anterior dispone de un interruptor que permite trabajar con 3.3V. Por lo tanto <strong>estando dicho interruptor en la posición 3.3V si sería posible la conexión anterior</strong>. Pero <strong>CUIDADO</strong> con despistarnos y cambiar el interruptor a 5V con las conexiones realizadas porque romperemos la micro:STEAMakers.</p>
</div>
</div>
<h2 id="procedimiento"><FONT COLOR=#007575><strong>Procedimiento</strong></font><a class="headerlink" href="#procedimiento" title="Permanent link">&para;</a></h2>
<p>Para nuestro proyecto necesitaremos dos conjuntos de programas: uno para la micro:STEAMakers y otro para el Arduino UNO o equivalente. Veremos ambos a continuación.</p>
<p>Pero antes de entrar en examinar el código para estas dos funciones, revisemos los bloques de codificación relacionados con I2C del IDE de microBlocks.</p>
<h3 id="bloques-i2c-de-microblocks"><FONT COLOR=#AA0000>Bloques I2C de microBlocks</font><a class="headerlink" href="#bloques-i2c-de-microblocks" title="Permanent link">&para;</a></h3>
<p>Los siguientes bloques componen las funciones I2C en microBlocks disponibles en el menú "Comm (Comunicaciones)":</p>
<ul>
<li>Este bloque lee el valor del Registro del dispositivo I2C seleccionado. El valor devuelto es un entero de un byte en el rango de 0 - 255.</li>
</ul>
<p><center></p>
<p><a class="glightbox" href="../../img/proyectos/B_get_en.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Bloque i2c get device..." src="../../img/proyectos/B_get_en.png" /></a><br />
<em>Bloque i2c get device...</em></p>
<p><a class="glightbox" href="../../img/proyectos/B_get_es.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Bloque lee del dispositivo i2c..." src="../../img/proyectos/B_get_es.png" /></a><br />
<em>Bloque lee del dispositivo i2c...</em></p>
<p></center></p>
<ul>
<li>Este bloque escribe un valor en el Registro seleccionado del dispositivo I2C seleccionado. El valor utilizado debe ser un entero de un byte en el rango de 0 - 255.</li>
</ul>
<p><center></p>
<p><a class="glightbox" href="../../img/proyectos/B_set_en.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Bloque i2c set device..." src="../../img/proyectos/B_set_en.png" /></a><br />
<em>Bloque i2c set device...</em></p>
<p><a class="glightbox" href="../../img/proyectos/B_set_es.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Bloque escribe al dispositivo i2c..." src="../../img/proyectos/B_set_es.png" /></a><br />
<em>Bloque escribe al dispositivo i2c...</em></p>
<p></center></p>
<ul>
<li>Este bloque nos permite leer múltiples bytes de datos del dispositivo I2C. La longitud de la lista determina cuántos bytes se intercambiarán. I2C tiene un límite interno de 32 bytes como máximo. Por lo tanto, sólo se pueden intercambiar entre 1 y 32 bytes a través de este bloque. Los valores de la lista deben ser enteros y estar comprendidos entre 0 y 255. Cualquier otro valor será ignorado.</li>
</ul>
<p><center></p>
<p><a class="glightbox" href="../../img/proyectos/B-i2c_read_en.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Bloque i2c device... read..." src="../../img/proyectos/B-i2c_read_en.png" /></a><br />
<em>Bloque i2c device... read...</em>  </p>
<p><a class="glightbox" href="../../img/proyectos/B-i2c_read_es.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Bloque lee del dispositivo i2c... a la lista" src="../../img/proyectos/B-i2c_read_es.png" /></a><br />
<em>Bloque lee del dispositivo i2c... a la lista</em></p>
<p></center></p>
<ul>
<li>Este bloque nos permite escribir múltiples bytes de datos en el dispositivo I2C. La longitud de la lista determina cuántos bytes se intercambiarán. I2C tiene un límite interno de 32 bytes como máximo. Los valores de la lista deben ser enteros y estar comprendidos entre 0 y 255. Cualquier otro valor será ignorado.</li>
</ul>
<p><center></p>
<p><a class="glightbox" href="../../img/proyectos/B_i2c_write_en.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Bloque i2c device... write list..." src="../../img/proyectos/B_i2c_write_en.png" /></a><br />
<em>loque i2c device... write list...</em></p>
<p><a class="glightbox" href="../../img/proyectos/B_i2c_write_es.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Bloque escribe al dispositivo i2c... el contenido de la lista..." src="../../img/proyectos/B_i2c_write_es.png" /></a><br />
<em>Bloque escribe al dispositivo i2c... el contenido de la lista...</em></p>
<p></center></p>
<p>Para nuestro proyecto, sólo haremos uso de los dos últimos bloques relacionados con listas. Veamos el código del programa con más detalle.</p>
<h3 id="programa-para-la-microsteamakers_v1"><FONT COLOR=#AA0000>Programa para la micro:STEAMakers_V1</font><a class="headerlink" href="#programa-para-la-microsteamakers_v1" title="Permanent link">&para;</a></h3>
<p>El programa en un momento de la ejecución lo vemos en la imagen siguiente:</p>
<p><center></p>
<p><a class="glightbox" href="../../img/proyectos/Programa_I2C_a_UNO_V1.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Programa" src="../../img/proyectos/Programa_I2C_a_UNO_V1.png" /></a><br />
<em>Programa</em></p>
<p></center></p>
<p>Realizamos un análisis de cada script por separado.</p>
<p><mark><strong>Botón A. Enviar</strong></mark></p>
<p>Lo que queremos que suceda es que cuando pulsamos el Botón-A en la micro:STEAMakers se envíe nuestro mensaje a la placa UNO.</p>
<ul>
<li><font color=#ff00ff>"cuando se pulsa el botón A"</font></li>
</ul>
<p><center></p>
<p><a class="glightbox" href="../../img/proyectos/BotA_1.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Botón A. Enviar" src="../../img/proyectos/BotA_1.png" /></a></p>
<p></center></p>
<p>Empezamos con el bloque "cuando se pulsa el botón A" y mostramos una imágen en la pantalla correspondiente a "&gt;A" para intentar indicar que la función está ENVIANDO datos.</p>
<ul>
<li><font color=#ff00ff>Definición de variables</font></li>
</ul>
<p><center></p>
<p><a class="glightbox" href="../../img/proyectos/BotA_2.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Botón A. Enviar" src="../../img/proyectos/BotA_2.png" /></a></p>
<p></center></p>
<p><strong>NoDispI2C</strong> es el número de dispositivo I2C que hemos decidido utilizar para el dispositivo esclavo, la placa UNO. La selección es totalmente arbitraria pudiendo ser cualquier número entre 8 y 127. Los primeros números (0 - 7 ) están reservados para el propio i2c.</p>
<p>La variable <strong>envioBuffer</strong> se utiliza para almacenar el texto del mensaje que queremos enviar al dispositivo UNO. En este ejemplo, he creado un mensaje de 33 bytes, aunque puede ser cualquier otro con las limitaciones ya expuestas, como veremos en la descripción del botón B.</p>
<p>La variable <strong>DatoI2C</strong> comienza como una lista VACIA. Necesitamos una variable de tipo lista porque el bloque "escribe al dispositivo i2c..." que utilizaremos para enviar nuestro mensaje multibyte así lo requiere.</p>
<ul>
<li><font color=#ff00ff>Rellenamos la lista con los datos suministrados</font></li>
</ul>
<p><center></p>
<p><a class="glightbox" href="../../img/proyectos/BotA_3.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Botón A. Enviar" src="../../img/proyectos/BotA_3.png" /></a></p>
<p></center></p>
<p>Como el texto de nuestro mensaje está en la variable de cadena <strong>envioBuffer</strong>, tenemos que convertirlo al formato de lista requerido por el bloque "escribe al dispositivo i2c...".</p>
<p>Recuerda que a I2C sólo le gustan los enteros entre 0 - 255, y no sabe nada de letras de texto o signos de puntuación, etc. Esto significa que tenemos que tomar todas y cada una de las letras de nuestro mensaje y convertirlas a un valor ASCII entre 0 - 255. Luego tenemos que almacenarlas una por una. Por tanto tenemos que almacenarlos uno por uno en ubicaciones consecutivas de la variable de tipo lista <strong>DatoI2C</strong>. Qué mejor manera de conseguirlo que dejar que microBlocks se encargue de la laboriosa tarea. Así que usamos un bloque de tipo bucle FOR para iterar a través de la longitud de la variable <strong>envioBuffer</strong>, y añadir cada letra a la lista <strong>DatoI2C</strong>. Al finalizar las iteraciones del bucle ya está en el formato apropiado, listo para ser enviado.</p>
<ul>
<li><font color=#ff00ff>Aquí es donde ocurre la acción</font></li>
</ul>
<p><center></p>
<p><a class="glightbox" href="../../img/proyectos/BotA_4.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Botón A. Enviar" src="../../img/proyectos/BotA_4.png" /></a></p>
<p></center></p>
<p>Le decimos a microBlocks que tome nuestra lista <strong>DatoI2C</strong> y la envíe al dispositivo I2C <strong>NoDispI2C</strong> 13.</p>
<p>Las rutinas de la librería I2C que se ejecutan en segundo plano mirarán la longitud variable de la lista <strong>DatoI2C</strong> y calcularán cuántos caracteres hay que enviar. Entonces la librería indicará a la placa UNO que hay 33 bytes de datos en camino, y los enviará. Hay una gran actividad que está sucediendo en segundo plano sin que se requiera de nuestra intervención o codificación. Tenemos que agradecer a microBlocks que nos lo haya puesto tan fácil. Sin embargo, no podemos decir lo mismo del lado del IDE de Arduino, como veremos más adelante.</p>
<ul>
<li><font color=#ff00ff>Final de la rutina ENVIAR</font></li>
</ul>
<p><center></p>
<p><a class="glightbox" href="../../img/proyectos/BotA_5.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Botón A. Enviar" src="../../img/proyectos/BotA_5.png" /></a></p>
<p></center></p>
<p>Para asegurarnos de que todo se ha completado en este punto, mostramos un mensaje indicando el número de bytes que hemos enviado y el contenido del buffer enviado.</p>
<p>Ahora, pasemos a la parte de RECEPCION.</p>
<p><mark><strong>Botón B. Recibir</strong></mark></p>
<p>Lo que queremos que suceda es que cuando pulsamos el Botón-B en la micro:STEAMakers se reciba un mensaje desde la placa UNO.</p>
<ul>
<li><font color=#ff00ff>"cuando se pulsa el botón B"</font></li>
</ul>
<p><center></p>
<p><a class="glightbox" href="../../img/proyectos/BotB_1.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Botón B. Recibir" src="../../img/proyectos/BotB_1.png" /></a></p>
<p></center></p>
<p>Empezamos con el bloque "cuando se pulsa el botón B" y mostramos una imágen en la pantalla correspondiente a "&lt; A" para intentar indicar que la función está RECIBIENDO datos.</p>
<ul>
<li><font color=#ff00ff>Definición de variables</font></li>
</ul>
<p><center></p>
<p><a class="glightbox" href="../../img/proyectos/BotB_2.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Botón B. Recibir" src="../../img/proyectos/BotB_2.png" /></a></p>
<p></center></p>
<p>De nuevo, tenemos que definir nuestras variables.</p>
<p><strong>NoDispI2C</strong> es el número de dispositivo I2C del que recibiremos.</p>
<p><strong>DatoI2C</strong> necesita ser configurado como una lista vacía de 32 entradas, lista para recibir el mensaje de la placa UNO.</p>
<ul>
<li><font color=#ff00ff>Bloque de acción</font></li>
</ul>
<p><center></p>
<p><a class="glightbox" href="../../img/proyectos/BotB_3.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Botón B. Recibir" src="../../img/proyectos/BotB_3.png" /></a></p>
<p></center></p>
<p>Indicamos a microBlocks que lea múltiples bytes del dispositivo 13 y coloque el mensaje entrante en la variable de tipo lista <strong>DatoI2C</strong>. En este caso tampoco hay mucho que hacer por nuestra parte, ya que microBlocks maneja los detalles de I2C en segundo plano. Sin embargo, examinemos lo que sucede en segundo plano: La librería I2C inicializará los detalles del protocolo I2C como la velocidad, y se designará a sí misma como maestra. Entonces mirará el tamaño de la lista <strong>DatoI2C</strong> y enviará un mensaje REQUEST al dispositivo 13 pidiendo 32 bytes de datos. Cuando esos datos lleguen los almacenará en la lista designada y cerrará el enlace I2C.</p>
<ul>
<li><font color=#ff00ff>Conversión de entero a carácter</font></li>
</ul>
<p><center></p>
<p><a class="glightbox" href="../../img/proyectos/BotB_4.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Botón B. Recibir" src="../../img/proyectos/BotB_4.png" /></a></p>
<p></center></p>
<p>En este caso se trata de un bloque de código de un bucle "for" con un condicional anidado que analizaremos en detalle.</p>
<p>Como hemos visto estamos limitando la longitud máxima de los datos entre uno y 32 bytes y para el manejo de los datos mas cortos se finalizan con un carácter NEWLINE al final en el programa del IDE de Arduino. De esta forma, buscando el carácter NEWLINE en el mensaje recibido en el lado micro:STEAMakers, podemos saber que es el final del mismo e ignorar el resto de los 32 bytes, si los hubiera. Ten en cuenta que esta es una decisión de diseño del programa y se indica lo anterior para facilitar la compresión del código.</p>
<p>El bucle FOR examina cada byte de la lista <strong>DatoI2C</strong> y busca un valor NEWLINE. El byte NEWLINE tiene un valor ASCII decimal de 10.</p>
<p><center></p>
<p><a class="glightbox" href="../../img/proyectos/BotB_5.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Botón B. Recibir" src="../../img/proyectos/BotB_5.png" /></a></p>
<p></center></p>
<p>Así que cuando encontramos esto en los bytes examinados, hacemos dos cosas:</p>
<p><center></p>
<p><a class="glightbox" href="../../img/proyectos/BotB_6.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img align="left" alt="Botón B. Recibir" src="../../img/proyectos/BotB_6.png" /></a></p>
<p></center></p>
<p><strong>1.</strong> En primer lugar, calculamos una variable local <strong>borraRecuento</strong> y almacenamos en ella el número de bytes que quedan hasta el final del buffer. Es decir, como hemos llegado al final del mensaje, calculamos cuántos bytes sobran, si es que sobran. Eso es lo que almacena la variable <strong>borraRecuento</strong>. Así que todo lo que haya después de la NEWLINE no nos interesa, y nos desharemos de ello.</p>
<p><center></p>
<p><a class="glightbox" href="../../img/proyectos/BotB_7.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img align="left" alt="Botón B. Recibir" src="../../img/proyectos/BotB_7.png" /></a></p>
<p></center></p>
<p><strong>2.</strong> En segundo lugar usamos un bucle REPETIR con <strong>borraRecuento</strong> como parámetro para borrar los bytes restantes de la lista <strong>DatoI2C</strong>. Usando la opción ELIMINA ELEMENTO ULTIMO de la lista, no tenemos que preocuparnos de dónde estamos en el proceso de borrado.</p>
<p>Esto nos deja con una lista limpia que contiene sólo los bytes válidos del mensaje entrante incluido el carácter NEWLINE que es el decimal 10.</p>
<p>Inmediatamente después, mostramos un mensaje para informar del final del proceso.</p>
<p><center></p>
<p><a class="glightbox" href="../../img/proyectos/BotB_8.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Botón B. Recibir" src="../../img/proyectos/BotB_8.png" /></a></p>
<p></center></p>
<p>El bloque "UNE ELEMENTOS DE LA LISTA..." sirve para convertir los valores de la lista <strong>DatoI2C</strong> en una cadena.</p>
<p>El bloque ESPERA debe ser del tiempo suficiente que nos permita ver y leer el mensaje mostrado.</p>
<p>El bloque RETURN simplemente sirve para salir del bucle FOR inmediatamente.</p>
<p>Si el byte examinado NO es el valor NEWLINE, significa que tenemos un contenido anormal de nuestro mensaje y debemos conservarlo.</p>
<p><center></p>
<p><a class="glightbox" href="../../img/proyectos/BotB_9.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Botón B. Recibir" src="../../img/proyectos/BotB_9.png" /></a></p>
<p></center></p>
<p>Como los valores de la lista están en formato entero, tenemos que convertirlos a formato cadena utilizando el bloque CARACTERR CON UNICODE, y sustituir el valor entero de la lista por esta nueva cadena.</p>
<p>Esto nos lleva al final de la lógica del bucle FOR.</p>
<p>Dado que existe la posibilidad de que un mensaje entrante contenga o no un byte NEWLINE, dependiendo de su longitud, el último bloque DI tiene en cuenta la visualización de los detalles, en caso de que NO encontremos el byte NEWLINE.</p>
<p>A continuación se muestra el programa cuando se pulsa el Botón-B y se recibe el mensaje de la placa tipo Arduino UNO o similar:</p>
<p><center></p>
<p><a class="glightbox" href="../../img/proyectos/BotB_eje.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Botón B. Recibir en ejecución" src="../../img/proyectos/BotB_eje.png" /></a><br />
<em>Botón B. Recibir en ejecución</em>
</center></p>
<h3 id="programa-para-la-microsteamakers_v2"><FONT COLOR=#AA0000>Programa para la micro:STEAMakers_V2</font><a class="headerlink" href="#programa-para-la-microsteamakers_v2" title="Permanent link">&para;</a></h3>
<p>El programa completo en un momento de la ejecución lo vemos en la imagen siguiente:</p>
<p><center></p>
<p><a class="glightbox" href="../../img/proyectos/Programa_I2C_a_UNO_V2.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Programa" src="../../img/proyectos/Programa_I2C_a_UNO_V2.png" /></a><br />
<em>Programa</em></p>
<p></center></p>
<p><mark><strong>Botón A. Enviar</strong></mark></p>
<p>Lo que queremos que suceda es que cuando pulsamos el Botón-A en la micro:STEAMakers se envíe nuestro mensaje a la placa UNO.</p>
<ul>
<li><font color=#ff00ff>"cuando se pulsa el botón A"</font></li>
</ul>
<p><center></p>
<p><a class="glightbox" href="../../img/proyectos/BotA_1.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Botón A. Enviar" src="../../img/proyectos/BotA_1.png" /></a></p>
<p></center></p>
<p>Empezamos con el bloque "cuando se pulsa el botón A" y mostramos una imágen en la pantalla correspondiente a "&gt;A" para intentar indicar que la función está ENVIANDO datos.</p>
<ul>
<li><font color=#ff00ff>Definición de variables</font></li>
</ul>
<p><center></p>
<p><a class="glightbox" href="../../img/proyectos/BotA_2.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Botón A. Enviar" src="../../img/proyectos/BotA_2.png" /></a></p>
<p></center></p>
<p><strong>NoDispI2C</strong> es el número de dispositivo I2C que hemos decidido utilizar para el dispositivo esclavo, la placa UNO. La selección es totalmente arbitraria pudiendo ser cualquier número entre 8 y 127. Los primeros números (0 - 7 ) están reservados para el propio i2c.</p>
<p>La variable <strong>envioBuffer</strong> se utiliza para almacenar el texto del mensaje que queremos enviar al dispositivo UNO. En este ejemplo, he creado un mensaje de 33 bytes, aunque puede ser cualquier otro con las limitaciones ya expuestas, como veremos en la descripción del botón B.</p>
<p>La variable <strong>DatoI2C</strong> comienza como una lista VACIA. Necesitamos una variable de tipo lista porque el bloque "escribe al dispositivo i2c..." que utilizaremos para enviar nuestro mensaje multibyte así lo requiere.</p>
<ul>
<li><font color=#ff00ff>Rellenamos la lista con los datos suministrados</font></li>
</ul>
<p><center></p>
<p><a class="glightbox" href="../../img/proyectos/BotA_3.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Botón A. Enviar" src="../../img/proyectos/BotA_3.png" /></a></p>
<p></center></p>
<p>Como el texto de nuestro mensaje está en la variable de cadena <strong>envioBuffer</strong>, tenemos que convertirlo al formato de lista requerido por el bloque "escribe al dispositivo i2c...".</p>
<p>Recuerda que a I2C sólo le gustan los enteros entre 0 - 255, y no sabe nada de letras de texto o signos de puntuación, etc. Esto significa que tenemos que tomar todas y cada una de las letras de nuestro mensaje y convertirlas a un valor ASCII entre 0 - 255. Luego tenemos que almacenarlas una por una. Por tanto tenemos que almacenarlos uno por uno en ubicaciones consecutivas de la variable de tipo lista <strong>DatoI2C</strong>. Qué mejor manera de conseguirlo que dejar que microBlocks se encargue de la laboriosa tarea. Así que usamos un bloque de tipo bucle FOR para iterar a través de la longitud de la variable <strong>envioBuffer</strong>, y añadir cada letra a la lista <strong>DatoI2C</strong>. Al finalizar las iteraciones del bucle ya está en el formato apropiado, listo para ser enviado.</p>
<ul>
<li><font color=#ff00ff>Aquí es donde ocurre la acción</font></li>
</ul>
<p><center></p>
<p><a class="glightbox" href="../../img/proyectos/BotA_4.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Botón A. Enviar" src="../../img/proyectos/BotA_4.png" /></a></p>
<p></center></p>
<p>Le decimos a microBlocks que tome nuestra lista <strong>DatoI2C</strong> y la envíe al dispositivo I2C <strong>NoDispI2C</strong> 13.</p>
<p>Las rutinas de la librería I2C que se ejecutan en segundo plano mirarán la longitud variable de la lista <strong>DatoI2C</strong> y calcularán cuántos caracteres hay que enviar. Entonces la librería indicará a la placa UNO que hay 33 bytes de datos en camino, y los enviará. Hay una gran actividad que está sucediendo en segundo plano sin que se requiera de nuestra intervención o codificación. Tenemos que agradecer a microBlocks que nos lo haya puesto tan fácil. Sin embargo, no podemos decir lo mismo del lado del IDE de Arduino, como veremos más adelante.</p>
<ul>
<li><font color=#ff00ff>Final de la rutina ENVIAR</font></li>
</ul>
<p><center></p>
<p><a class="glightbox" href="../../img/proyectos/BotA_5.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Botón A. Enviar" src="../../img/proyectos/BotA_5.png" /></a></p>
<p></center></p>
<p>Para asegurarnos de que todo se ha completado en este punto, mostramos un mensaje indicando el número de bytes que hemos enviado y el contenido del buffer enviado.</p>
<p>Ahora, pasemos a la parte de RECEPCION.</p>
<p><mark><strong>Botón B. Recibir</strong></mark></p>
<p>Lo que queremos que suceda es que cuando pulsamos el Botón-B en la micro:STEAMakers se reciba un mensaje desde la placa UNO.</p>
<ul>
<li><font color=#ff00ff>"cuando se pulsa el botón B"</font></li>
</ul>
<p><center></p>
<p><a class="glightbox" href="../../img/proyectos/BotB_1.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Botón B. Recibir" src="../../img/proyectos/BotB_1.png" /></a></p>
<p></center></p>
<p>Empezamos con el bloque "cuando se pulsa el botón B" y mostramos una imágen en la pantalla correspondiente a "&lt; A" para intentar indicar que la función está RECIBIENDO datos.</p>
<ul>
<li><font color=#ff00ff>Definición de variables</font></li>
</ul>
<p><center></p>
<p><a class="glightbox" href="../../img/proyectos/BotB_2_2.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Botón B. Recibir" src="../../img/proyectos/BotB_2_2.png" /></a></p>
<p></center></p>
<p>De nuevo, tenemos que definir nuestras variables.</p>
<p><strong>NoDispI2C</strong> es el número de dispositivo I2C del que recibiremos.</p>
<p><strong>borraRecuento</strong> es la variable que va contener los bytes posteriores a NEWLINE que deben ser borrados.</p>
<p><strong>DatoI2C</strong> necesita ser configurado como una lista vacía de 32 entradas, lista para recibir el mensaje de la placa UNO.</p>
<ul>
<li><font color=#ff00ff>Bloque de acción</font></li>
</ul>
<p><center></p>
<p><a class="glightbox" href="../../img/proyectos/BotB_3.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Botón B. Recibir" src="../../img/proyectos/BotB_3.png" /></a></p>
<p></center></p>
<p>Indicamos a microBlocks que lea múltiples bytes del dispositivo 13 y coloque el mensaje entrante en la variable de tipo lista <strong>DatoI2C</strong>. En este caso tampoco hay mucho que hacer por nuestra parte, ya que microBlocks maneja los detalles de I2C en segundo plano.</p>
<p>Sin embargo, examinemos lo que sucede en segundo plano: La librería I2C inicializará los detalles del protocolo I2C como la velocidad, y se designará a sí misma como maestra. Entonces mirará el tamaño de la lista <strong>DatoI2C</strong> y enviará un mensaje REQUEST al dispositivo 13 pidiendo 32 bytes de datos. Cuando esos datos lleguen los almacenará en la lista designada y cerrará el enlace I2C.</p>
<ul>
<li>
<p><font color=#ff00ff>Proceso de datos entrantes en dos fases</font></p>
<p><strong>Primero</strong> miramos si hay algún caracter NL (valor decimal 10) en el mensaje. Como hemos decidido, podemos enviar y recibir 32 bytes de mensajes. Sin embargo, si queremos enviar y recibir menos que eso, entonces tenemos que añadir un carácter NL después del último byte.</p>
<p><strong>Segundo</strong> tomamos los valores de bytes decimales recibidos y los convertimos en una cadena legible.</p>
</li>
</ul>
<p>Veamos cómo hemos escrito el código para hacer estas cosas:</p>
<p><center></p>
<p><a class="glightbox" href="../../img/proyectos/BotB_4_2.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Botón B. Recibir" src="../../img/proyectos/BotB_4_2.png" /></a></p>
<p></center></p>
<p>Como hemos visto estamos limitando la longitud máxima de los datos entre uno y 32 bytes y para el manejo de los datos mas cortos se finalizan con un carácter NEWLINE al final en el programa del IDE de Arduino. De esta forma, buscando el carácter NEWLINE en el mensaje recibido en el lado micro:STEAMakers, podemos saber que es el final del mismo e ignorar el resto de los 32 bytes, si los hubiera. Ten en cuenta que esta es una decisión de diseño del programa y se indica lo anterior para facilitar la compresión del código.</p>
<p>El bloque IF, en combinación con el bloque "busca"", examina cada byte del <strong>DatoI2C</strong> y busca el valor NL. El byte NL tiene un valor decimal ASCII de 10. Así que si lo encuentra en los bytes examinados, devolverá su ubicación. Si no lo encuentra, devolverá -1. Para comprobar si hemos encontrado algo, configuramos el bloque if para que se ejecute si la condición NO ES IGUAL a -1, lo que significa que hay un NL en el mensaje.</p>
<p><center></p>
<p><a class="glightbox" href="../../img/proyectos/BotB_5_2.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Botón B. Recibir" src="../../img/proyectos/BotB_5_2.png" /></a></p>
<p></center></p>
<p>Así que cuando encontramos esto en los bytes examinados, hacemos dos cosas:</p>
<p><strong>1.</strong> En primer lugar, calculamos una variable local <strong>borraRecuento</strong> y almacenamos en ella el número de bytes que quedan hasta el final del buffer. Es decir, como hemos llegado al final del mensaje, calculamos cuántos bytes sobran, si es que sobran. Eso es lo que almacena la variable <strong>borraRecuento</strong>. Así que todo lo que haya después de la NEWLINE no nos interesa, y nos desharemos de ello.</p>
<p><center></p>
<p><a class="glightbox" href="../../img/proyectos/BotB_6_2.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Botón B. Recibir" src="../../img/proyectos/BotB_6_2.png" /></a></p>
<p></center></p>
<p><strong>2.</strong> En segundo lugar usamos un bucle REPETIR con <strong>borraRecuento</strong> como parámetro para borrar los bytes restantes de la lista <strong>DatoI2C</strong>. Usando la opción ELIMINA ELEMENTO ULTIMO de la lista, no tenemos que preocuparnos de dónde estamos en el proceso de borrado. Esto nos deja con una lista limpia que contiene sólo los bytes válidos del mensaje entrante.</p>
<p><center></p>
<p><a class="glightbox" href="../../img/proyectos/BotB_7_2.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Botón B. Recibir" src="../../img/proyectos/BotB_7_2.png" /></a></p>
<p></center></p>
<p>Ahora que tenemos un búfer limpio con nada más que los caracteres reales del mensaje, tenemos que convertir los valores de bytes decimales a un formato de cadena más legible.</p>
<p><center></p>
<p><a class="glightbox" href="../../img/proyectos/BotB_8_2.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Botón B. Recibir" src="../../img/proyectos/BotB_8_2.png" /></a></p>
<p></center></p>
<p>Esta tarea es muy fácil gracias a la ayuda que proporcionan los bloques de manipulación de datos de Microblocks. Como el bloque "lista de bytes a partir de..." que convierte la variable de tipo lista en un formato byteArray (matriz de valores tipo byte). Ya podemos utilizar el bloque "une micro blocks" con un primer parámetro vacío, lo que fuerza a que todo el byteArray se convierta al formato cadena de texto.</p>
<p>A continuación se muestra el programa cuando se pulsa el Botón-B y se recibe el mensaje de la placa tipo Arduino UNO o similar:</p>
<p><center></p>
<p><a class="glightbox" href="../../img/proyectos/BotB_eje_2.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Botón B. Recibir en ejecución" src="../../img/proyectos/BotB_eje_2.png" /></a><br />
<em>Botón B. Recibir en ejecución</em></p>
<p></center></p>
<p>Con esto hemos llegado con éxito al final de los código de micro:STEAMakers en MicroBlocks.</p>
<h3 id="codigo-para-el-ide-de-arduino"><FONT COLOR=#AA0000>Código para el IDE de Arduino</font><a class="headerlink" href="#codigo-para-el-ide-de-arduino" title="Permanent link">&para;</a></h3>
<div class="admonition info">
<p>El código para la placa Arduino UNO o equivalente trabaja con la libreria "Wire" que se incluye con el IDE de Arduino.</p>
<p><center></p>
<p><a class="glightbox" href="../../img/proyectos/placas.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Placas UNO" src="../../img/proyectos/placas.png" /></a></p>
<p></center></p>
</div>
<p>Una vez más, tenemos un único programa que servirá como sistema Receptor y Transmisor. </p>
<p>En la imagen siguiente vemos el código:</p>
<p><center></p>
<p><a class="glightbox" href="../../img/proyectos/comunicacion_i2c.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Código en el IDE 2.3.4 de Arduino" src="../../img/proyectos/comunicacion_i2c.png" /></a><br />
<em><a href="../../program/comunicacion_i2c/comunicacion_i2c.ino">Código en el IDE 2.3.4 de Arduino</a></em></p>
<p></center></p>
<p>El programa Arduino incluye la librería "Wire" y cuatro funciones:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="o">&lt;</span><span class="n">Wire</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;</span>
</code></pre></div>
<p>Esta librería proporciona la funcionalidad I2C.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="n">setup</span><span class="p">()</span>
</code></pre></div>
<p>Se inicializa la librería Wire con el dispositivo I2C 13.</p>
<p>Se declaran dos eventos como funciones para manejar los eventos RECEIVE y SEND del I2C.</p>
<p>Luego se inicializa el puerto Serial a 9600 baudios para habilitar la visualización de mensajes del programa.</p>
<p>Y se muestra el mensaje "Listo..." en la consola Serial.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="n">loop</span><span class="p">()</span>
</code></pre></div>
<p>En este caso el bucle principal del programa no se utiliza, ya que los eventos I2C son controlados por interrupciones y manejados por los respectivos manejadores de eventos de Recepción (Receive) y Solicitud (Request).</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="n">EventoRecibir</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">cuantos</span><span class="p">)</span>
</code></pre></div>
<ul>
<li>Este es el manejador que procesa los mensajes I2C recibidos por el Arduino.</li>
<li>Muestra el número de bytes recibidos en la consola Serial</li>
<li>Los bytes entrantes son leídos desde I2C usando la función <code>Wire.read()</code> en la variable '''cuan```</li>
<li>Imprime cada byte que recibe en la consola Serial</li>
<li>Adicionalmente, imprime el último byte en formato ASCII DECIMAL para facilitar la diferenciación de cualquier carácter de terminación.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="n">EventoSolicitar</span><span class="p">()</span>
</code></pre></div>
<ul>
<li>Este es el manejador que envía el mensaje designado almacenado en el array <code>respuesta[ ]</code>.</li>
<li>El mensaje puede tener hasta 32 bytes de longitud. Si se desea un mensaje más corto, basta con añadir un byte "\n", que es el carácter NEWLINE para terminar el mensaje.</li>
<li>La micro:STEAMakers buscará este byte NEWLINE e ignorará el resto de la matriz del búfer.</li>
<li>El mensaje se envía utilizando la llamada a la función <code>Wire.write(respuesta)</code>.</li>
</ul>
<p>Con todos los códigos de programa del proyecto analizados, ya podemos ejecutarlos y mirar la salida de la pantalla de la consola serie de Arduino.</p>
<p><center></p>
<p><a class="glightbox" href="../../img/proyectos/comunicacion_i2c_serial.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Consola serie tras pulsar el botón A" src="../../img/proyectos/comunicacion_i2c_serial.png" /></a><br />
<em>Consola serie tras pulsar el botón A</em></p>
<p></center></p>
<p>Dado que estamos enviando un mensaje de 33 bytes de micro:STEAMakers a la placa UNO teniendo limitada la longitud a 32 bytes, el final del mensaje se termina con el carácter 32 ignorándose el resto. El mensaje nos indica cual es el valor del último caracter recibido tanto en digito como en valor ASCII. Si eliminamos los números en el programa de MicroBlocks el resultado sería el siguiente:</p>
<p><center></p>
<p><a class="glightbox" href="../../img/proyectos/comunicacion_i2c_serial2.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Consola serie tras pulsar el botón A" src="../../img/proyectos/comunicacion_i2c_serial2.png" /></a><br />
<em>Consola serie tras pulsar el botón A</em></p>
<p></center></p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2023 - 2035 Federico Coca
    </div>
  
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="https://github.com/fgcoca" target="_blank" rel="noopener" title="Github de Federico Coca" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://www.instagram.com/cocafederico/?hl=es" target="_blank" rel="noopener" title="Instagram de Federico Coca" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://x.com/clubroboticagra" target="_blank" rel="noopener" title="X de Club Robótica Granada" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8l164.9-188.5L26.8 48h145.6l100.5 132.9L389.2 48zm-24.8 373.8h39.1L151.1 88h-42l255.3 333.8z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "content.code.copy"], "search": "../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version": "Seleccionar versi\u00f3n"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.aecac24b.min.js"></script>
      
        <script src="../../plugins/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>